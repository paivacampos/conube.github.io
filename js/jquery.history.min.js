(function($,undefined){var Public=function(url){if(_type==="pathname"){if(_last!==url)window.history.pushState({},null,_last=url)}else if(_type==="hash"){if(_last!==url){_last=location.hash=url;if(_ie67){if(!$("#jQueryHistory").length)throw new Error("jQuery."+publicName+".push: iframe not found.");if(_firstTime){_firstTime=0;_iframe.contentWindow.document.open().close();_iframe.contentWindow.location.hash="/"}_iframe.contentWindow.document.open().close();_iframe.contentWindow.location.hash=url}}}else throw new Error("jQuery."+
publicName+".push: listener is not active.");Public.context.trigger("push",[url,_type]);return Public},publicName="history";Public.context=$({});$.each(["on","off","trigger"],function(index,method){Public[method]=function(){Public.context[method].apply(Public.context,arguments);return Public}});Public.push=Public;Public.getListenType=function(){return _type};Public.listen=function(type,interval){Public.unlisten();var size=arguments.length;if(!size||type==="auto"){type=_pushState?"pathname":"hash";
size=1}else if(type!=="pathname"&&type!=="hash")throw new Error("jQuery."+publicName+".listen: type is not valid.");if(type==="hash"){if(!_onhashchange&&size===1||interval===true){interval=Public.config.interval;size=2}if(size===2&&(isNaN(interval)||interval<1))throw new Error("jQuery."+publicName+".listen: interval delay is not valid.");}if((_type=type)==="pathname"){if(!_pushState)throw new Error("jQuery."+publicName+".listen: this browser has not support to pushState.");$(window).on("popstate.history",
function(event){if(event.originalEvent&&(event.originalEvent.state&&_last!==location.pathname))Public.trigger("change",[_last=location.pathname,"pathname"])});if(location.pathname.length>1)Public.trigger("load",[location.pathname+location.search+location.hash,"pathname"])}else{if(_onhashchange&&!interval)$(window).on("hashchange.history",function(event){var hash=location.hash.substr(1);if(_last!==hash)Public.trigger("change",[_last=hash,"hash"])});else{if(_ie67===undefined)_ie67=Public.isIE67();if(_ie67){if(!(size=
$("body")).length)throw new Error("jQuery."+publicName+".listen: document is not ready.");_iframe=$('<iframe id="jQueryHistory" style="display:none" src="javascript:void(0);" />').appendTo(size)[0];var win=_iframe.contentWindow;if(location.hash.length>1){win.document.open().close();win.location.hash=location.hash}_interval=setInterval(function(){if((_last=location.hash)!==win.location.hash){win.document.open().close();win.location.hash=_last;Public.trigger("change",[_last.substr(1),"hash"])}},interval)}else{_last=
location.hash.substr(1);_interval=setInterval(function(){var hash=location.hash.substr(1);if(_last!==hash)Public.trigger("change",[_last=hash,"hash"])},interval)}}if(location.hash.length>1)Public.trigger("load",[location.hash.substr(1),"hash"])}return Public};Public.unlisten=function(){_type=_last=_iframe=null;$(window).off("popstate.history hashchange.history");$("#jQueryHistory").remove();clearInterval(_interval);return Public};Public.getSupports=function(type){var result={},size=arguments.length,
docmode;if(!size||type==="pushState")result.pushState="pushState"in window.history;if(!size||type==="onhashchange")result.onhashchange="onhashchange"in window&&((docmode=document.documentMode)===undefined||docmode>7);if(size)return result[type];return result};Public.isIE67=function(){var name="_history_msie",$msie,result;window[name]=false;$msie=$('<span>\x3c!--[if lte IE 7]><script type="text/javascript">window.'+name+"=true;\x3c/script><![endif]--\x3e</span>").appendTo("body");result=window[name]===
true;try{delete window[name]}catch(e){window[name]=undefined}$msie.remove();return result};Public.supports=Public.getSupports();Public.config={interval:100};var _pushState=Public.supports.pushState,_onhashchange=Public.supports.onhashchange,_ie67,_type=null,_interval,_iframe,_firstTime=1,_last;$[publicName]=Public})(jQuery);
